<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENEM Quest</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- VARI√ÅVEIS E TEMA (DARK GLOSSY / CYBERPUNK) --- */
        :root {
            --bg-dark: #0a0a0f;
            --bg-panel: rgba(20, 20, 30, 0.7);
            --primary: #00f3ff; /* Ciano Neon */
            --secondary: #bc13fe; /* Roxo Neon */
            --success: #00ff9d;
            --text-main: #ffffff;
            --text-muted: #a0a0b0;
            --glass: blur(12px);
            --border-radius: 16px;
            --glow-primary: 0 0 15px rgba(0, 243, 255, 0.3);
            --glow-secondary: 0 0 15px rgba(188, 19, 254, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--bg-dark);
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(188, 19, 254, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.1) 0%, transparent 40%);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 80px; /* Espa√ßo para nav mobile */
        }

        body.no-scroll {
            overflow: hidden;
        }

        /* --- HUD & HEADER --- */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: var(--glass);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; /* Mant√©m espa√ßamento */
            align-items: center;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: var(--glow-primary);
        }

        .hud-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .timer-box {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            color: var(--primary);
            box-shadow: var(--glow-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-mini {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer; transition: 0.3s;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            border: 2px solid #fff;
            overflow: hidden;
            flex-shrink: 0; /* Impede que o avatar seja esmagado/achatado */
        }

        /* --- √ÅREA DO BANNER --- */
        .banner-container {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        .banner-box {
            width: 100%;
            height: auto;
            background: #000;
            border-bottom: 2px solid var(--primary); /* Borda Neon */
            display: block;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 243, 255, 0.15); /* Glow Neon Ambiente */
        }

        /* Efeito Scanline (Textura Cyberpunk sutil) */
        .banner-box::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 243, 255, 0.03) 3px);
            pointer-events: none;
            z-index: 2;
        }

        /* Efeito de degrad√™ na base para integrar o banner ao fundo */
        .banner-box::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 80px;
            background: linear-gradient(to top, var(--bg-dark), transparent);
            pointer-events: none;
            z-index: 2;
        }

        /* --- LAYOUT PRINCIPAL --- */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        /* --- NAVEGA√á√ÉO PRINCIPAL (ABAS) --- */
        .main-nav {
            grid-column: 2;
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
            margin-top: -1rem; /* Ajuste visual */
            padding-top: 1rem;
        }

        .nav-item {
            background: none;
            border: none;
            color: var(--text-muted);
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            transition: 0.3s;
            position: relative;
        }

        .nav-item:hover { color: #fff; }
        
        .nav-item.active {
            color: var(--primary);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -0.6rem;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            box-shadow: var(--glow-primary);
        }

        /* --- √ÅREA DE CONTE√öDO --- */
        .content-section {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- SIDEBAR / PROFILE --- */
        .profile-card {
            background: var(--bg-panel);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .profile-header-large {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .stat-value {
            color: var(--text-main);
            font-weight: 600;
        }

        .xp-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* --- TIMELINE DE MISS√ïES --- */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--primary), var(--secondary), transparent);
            box-shadow: var(--glow-primary);
        }

        .level-section {
            margin-bottom: 3rem;
            opacity: 0.5;
            transition: opacity 0.3s;
            filter: blur(1px);
            /* pointer-events: none; Removido para permitir controle granular por miss√£o */
        }

        .level-section.active, .level-section.completed {
            opacity: 1;
            filter: blur(0);
            pointer-events: auto;
        }

        /* .level-section:not(.active) .mission-card {
            pointer-events: none;
        } Removido pois agora usamos a classe .locked */

        .level-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .level-badge {
            position: absolute;
            left: -2.6rem;
            width: 20px;
            height: 20px;
            background: var(--bg-dark);
            border: 2px solid var(--primary);
            border-radius: 50%;
            box-shadow: var(--glow-primary);
            z-index: 2;
        }

        .level-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--primary);
        }

        /* --- ESTILO YOUTUBE (V√çDEOS) --- */
        .video-grid {
            display: grid;
            /* Usa preenchimento autom√°tico para criar colunas responsivas sem media queries expl√≠citas */
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .video-card {
            background: rgba(30, 30, 40, 0.4);
            border-radius: 12px;
            overflow: hidden;
            transition: 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
            position: relative; /* Para o √≠cone de play */
        }

        .video-card:hover {
            transform: translateY(-8px);
            background: rgba(30, 30, 40, 0.9);
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(0, 243, 255, 0.1);
        }

        /* √çcone de Play que aparece no hover */
        .video-card::before {
            content: '‚ñ∂';
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            font-size: 3.5rem;
            color: #fff;
            background: rgba(0,0,0,0.6);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 70px;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 5;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .video-card:hover::before {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .video-thumb-wrapper {
            overflow: hidden;
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .video-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .video-card:hover .video-thumb {
            transform: scale(1.05);
        }

        .video-info {
            padding: 1rem 1.2rem;
        }

        .video-title {
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }

        .video-meta { 
            color: var(--text-muted); 
            font-size: 0.85rem; 
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .video-meta::before {
            content: 'üì∫';
            opacity: 0.7;
        }

        /* --- GRID DE MISS√ïES (NOVO LAYOUT) --- */
        .missions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 colunas no desktop */
            gap: 1.5rem;
            /* Layout responsivo que cria colunas de no m√≠nimo 260px, evitando que fiquem esticadas ou espremidas */
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 2rem; /* Aumenta o espa√ßamento entre os cards */
            margin-top: 1rem;
        }

        .mission-card {
            display: flex;
            flex-direction: column;
            background: rgba(30, 30, 40, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0; /* Remove padding para a imagem encostar na borda */
            height: 380px; /* Altura aumentada para estilo "Post/Retrato" */
            padding: 0;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .mission-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            background: rgba(30, 30, 40, 0.9);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .mission-card.locked {
            opacity: 0.4;
            filter: grayscale(0.9);
            pointer-events: none;
            cursor: not-allowed;
            border-color: rgba(255,255,255,0.05);
        }

        .mission-card.locked::after {
            content: 'üîí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            z-index: 10;
            text-shadow: 0 0 20px #000;
        }

        .mission-duration {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.3rem;
        }
        .mission-duration span {
            color: var(--primary);
            font-weight: 600;
        }

        .mission-img {
            width: 100%;
            height: 240px; /* Imagem bem maior (destaque) */
            height: 200px; /* Altura da imagem ajustada para melhor propor√ß√£o */
            object-fit: cover;
            background: #222;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .mission-content {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .mission-card.done {
            border-color: var(--success);
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .tag {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .tag.strategy { background: rgba(188, 19, 254, 0.2); color: var(--secondary); }
        .tag.exam { background: rgba(0, 243, 255, 0.2); color: var(--primary); }
        .tag.review { background: rgba(255, 165, 0, 0.2); color: orange; }
        .tag.boss { background: rgba(255, 0, 0, 0.2); color: #ff4d4d; border: 1px solid #ff4d4d; }

        .mission-percent {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .mission-card.done .mission-percent { color: var(--success); text-shadow: 0 0 5px var(--success); }

        .score-badge {
            background: linear-gradient(90deg, #ffd700, #ffaa00);
            color: #000;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            margin-left: 1rem;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #1a1a20;
            border: 1px solid var(--primary);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--glow-primary);
            text-align: center;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .close-modal-btn:hover { color: #fff; }

        /* --- ESTILO DO PLAYER DE V√çDEO (MELHORADO) --- */
        #video-player-modal .modal-content {
            max-width: 900px;
            width: 95%;
            padding: 0;
            overflow-y: auto;
            background: var(--bg-dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        .video-iframe-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            width: 100%;
            background: #000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .video-player-info {
            padding: 1.5rem 2rem;
        }

        #video-player-title {
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
            font-family: 'Orbitron', sans-serif;
            line-height: 1.3;
        }

        #video-player-channel {
            color: var(--text-main);
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1rem;
            opacity: 0.9;
        }

        #video-player-desc {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.6;
            padding-right: 10px;
        }

        /* --- ESTILO DO PLAYER DE V√çDEO --- */
        .close-video-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }
        .close-video-btn:hover { background: var(--primary); color: #000; transform: scale(1.1); }

        .btn {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border: none;
            padding: 0.8rem 2rem;
            color: #fff;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            font-family: 'Orbitron', sans-serif;
            transition: opacity 0.2s;
        }

        .btn:hover { opacity: 0.9; }
        
        .btn.undo {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
        }
        .btn.undo:hover { border-color: #fff; color: #fff; }

        /* --- TABS & PREVIEW (NEW) --- */
        .modal-tabs { display: flex; gap: 1rem; margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .tab-btn { background: none; border: none; color: var(--text-muted); padding: 0.5rem 1rem; cursor: pointer; font-family: 'Orbitron', sans-serif; border-bottom: 2px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        .profile-preview-card {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
            transition: 0.3s;
        }
        .preview-avatar {
            width: 100px; height: 100px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 3rem;
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background-size: cover; background-position: center;
            position: relative; z-index: 2;
        }
        .preview-bg-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 12rem; opacity: 0.1; pointer-events: none; z-index: 1; filter: blur(2px);
        }
        .color-grid { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 0.5rem; }
        .color-option { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid rgba(255,255,255,0.2); transition: 0.2s; }
        .color-option.selected { transform: scale(1.2); border-color: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.5); }

        /* --- VISUAL TAB LAYOUT --- */
        .visual-tab-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .visual-tab-grid {
                grid-template-columns: 1fr;
            }
        }

        /* --- FORM STYLES (PROFESSIONAL) --- */
        .form-group { margin-bottom: 1.2rem; text-align: left; }
        .form-label { display: block; color: var(--text-muted); margin-bottom: 0.5rem; font-size: 0.9rem; }
        .form-input, .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 0.8rem;
            border-radius: 12px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        .form-input:focus, .form-select:focus {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            transform: translateY(-2px);
        }

        .form-select option {
            background-color: #1a1a20;
            color: #fff;
        }
        
        .avatar-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        .avatar-option {
            width: 50px; height: 50px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            opacity: 0.5;
            transition: 0.3s;
        }
        .avatar-option.selected { border-color: var(--primary); opacity: 1; transform: scale(1.1); }
        .avatar-option img { width: 100%; height: 100%; border-radius: 50%; }

        /* --- DATA GRID LAYOUT --- */
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        .full-width { grid-column: span 2; }
        @media (max-width: 600px) {
            .data-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
        }

        /* --- QUIZ STYLES --- */
        .quiz-container { text-align: left; max-height: 60vh; overflow-y: auto; padding-right: 10px; }
        .quiz-question { margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem; }
        .quiz-opt { display: block; padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.05); border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .quiz-opt:hover { background: rgba(255,255,255,0.1); }
        .quiz-opt.selected { background: var(--primary); color: #000; font-weight: bold; }

        /* --- MISSION MODAL IMPROVEMENTS --- */
        .mission-modal-banner {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 1.2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border-bottom: 2px solid var(--primary);
        }

        .mission-desc-box {
            text-align: left;
            background: rgba(255, 255, 255, 0.03);
            padding: 1.2rem;
            border-radius: 12px;
            border-left: 4px solid var(--secondary);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #e0e0e0;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }
        
        .mission-desc-box strong {
            color: var(--primary);
            font-weight: 700;
        }

        .mission-reward-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(90deg, rgba(0, 243, 255, 0.05), transparent);
            border: 1px solid rgba(0, 243, 255, 0.2);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .mission-reward-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: var(--success);
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
        }

        /* --- RESPONSIVIDADE --- */
        @media (max-width: 768px) {
            main { grid-template-columns: 1fr; }
            
            /* Header Compacto */
            header { flex-direction: column; padding: 1rem; gap: 1rem; height: auto; }
            .logo { font-size: 1rem; }
            .hud-stats { width: 100%; justify-content: center; gap: 1.5rem; }
            .timer-box { font-size: 0.75rem; padding: 0.3rem 0.5rem; }
            #user-name-display { font-size: 0.9rem; }
            .user-mini { gap: 5px; }
            .user-mini .avatar { width: 30px; height: 30px; font-size: 0.8rem; border-width: 1px; }

            /* Profile Card Otimizado */
            .profile-card { 
                display: block; 
                position: static; 
                margin-bottom: 1.5rem; 
                padding: 1rem;
            }
            .profile-header-large {
                display: flex;
                align-items: center;
                gap: 1rem;
                text-align: left;
                margin-bottom: 1rem;
            }
            #sidebar-avatar {
                width: 50px !important;
                height: 50px !important;
                font-size: 1.2rem !important;
                margin: 0 !important;
            }
            #sidebar-name { font-size: 1.1rem; margin: 0; }
            #sidebar-course { font-size: 0.75rem; margin: 0; opacity: 0.8; line-height: 1.2; } /* Curso menor */
            .stat-row { font-size: 0.8rem; margin-bottom: 0.4rem; padding: 0.2rem 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
            .profile-card h3 { font-size: 0.9rem; margin-bottom: 0.5rem; }

            /* Timeline Compacta */
            .timeline { padding-left: 1rem; }
            .level-header { margin-bottom: 1rem; }
            .level-title { font-size: 1.1rem; }
            .level-badge { left: -1.35rem; width: 14px; height: 14px; }
            .score-badge { font-size: 0.7rem; padding: 0.2rem 0.5rem; margin-left: 0.5rem; }

            /* Grid de Miss√µes Mobile (2 colunas) */
            .missions-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 colunas no celular */
                gap: 0.8rem;
            }
            .missions-grid { gap: 1.5rem; }
            /* O grid de v√≠deos agora √© responsivo por padr√£o com auto-fill, mas podemos ajustar o gap */
            .video-grid {
                gap: 1rem;
            }
            .video-card::before {
                width: 50px; height: 50px; font-size: 2.5rem; line-height: 50px;
            }

            .mission-card { height: auto; min-height: 260px; }
            .mission-card { /* Altura agora √© autom√°tica */ }
            .mission-img { height: 140px; }
            .mission-content { padding: 0.6rem; }
            .mission-card h4 { 
                font-size: 0.85rem; 
                line-height: 1.3; 
                margin-bottom: 0.5rem;
                display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
            }
            .tag { font-size: 0.6rem; padding: 2px 4px; }
            .mission-footer span { font-size: 0.7rem !important; }

            /* Modais Ajustados */
            .modal-content { padding: 1rem; width: 90%; max-height: 85vh; }
            .modal-content h2 { font-size: 1.1rem; margin-bottom: 0.5rem !important; }
            .video-player-info {
                padding: 1rem 1.5rem;
            }
            #video-player-title {
                font-size: 1.2rem;
            }
            #video-player-desc {
                font-size: 0.9rem;
            }
            .modal-content p { font-size: 0.85rem; line-height: 1.4; margin-bottom: 1rem !important; }
            
            /* Profile Mobile Optimization */
            .profile-preview-card { min-height: 160px !important; padding: 1rem; margin-bottom: 1rem !important; }
            .preview-avatar { width: 70px; height: 70px; font-size: 2rem; margin-bottom: 0.5rem; }
            .preview-bg-icon { font-size: 6rem; }
            .form-group { margin-bottom: 0.8rem; }
            .form-label { font-size: 0.8rem; margin-bottom: 0.3rem; }
            .form-input, .form-select { padding: 0.6rem; font-size: 0.9rem; }
            .avatar-option { width: 40px; height: 40px; font-size: 1.2rem; }
            .color-option { width: 30px; height: 30px; }
            .btn { padding: 0.6rem 1.5rem; font-size: 0.9rem; margin-top: 0.5rem; }

            /* Ajuste Nav Mobile */
            main { display: flex; flex-direction: column; }
            .main-nav { grid-column: 1; order: -1; margin-bottom: 1rem; justify-content: center; }
            .nav-item { font-size: 0.9rem; padding: 0.5rem; }
            .content-section { width: 100%; }
        }

        /* Telas muito pequenas (iPhone SE, etc) */
        @media (max-width: 480px) {
            .missions-grid {
                grid-template-columns: repeat(1, 1fr); /* For√ßa 1 coluna nas tarefas para melhor leitura */
            }
            /* O grid de miss√µes j√° se ajusta para 1 coluna naturalmente com auto-fit */
        }

        @media (max-width: 350px) {
            .missions-grid {
                grid-template-columns: repeat(1, 1fr);
            }
        }
    </style>
</head>
<body>

    <!-- HEADER / HUD -->
    <header>
        <div class="logo">ENEM<span style="color:white">QUEST</span></div>
        <div class="hud-stats">
            <div class="timer-box" id="countdown">
                ‚åõ <span id="days-left">000</span> DIAS
            </div>
            <div class="user-mini" onclick="openProfileSettings()">
                <div class="avatar" id="user-avatar">U</div>
                <span id="user-name-display">Candidato</span>
            </div>
        </div>
    </header>

    <!-- ESPA√áO PARA O BANNER -->
    <div class="banner-container">
        <div class="banner-box">
            <img src="./assets/img/banner.png" style="width: 100%; height: auto; display: block;" alt="Banner Principal">
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main>
        <!-- SIDEBAR (STATS) -->
        <aside>
            <div class="profile-card">
                <div class="profile-header-large">
                    <div class="avatar" id="sidebar-avatar" style="width: 80px; height: 80px; margin: 0 auto 1rem; font-size: 2rem;">U</div>
                    <h2 id="sidebar-name">Estudante</h2>
                    <p id="sidebar-course" style="color: var(--primary); font-size: 0.9rem;">Curso n√£o definido</p>
                </div>
                <h3 style="margin-bottom: 1rem; color: var(--primary);">Status do Jogador</h3>
                <div class="stat-row">
                    <span>N√≠vel Atual</span>
                    <span class="stat-value" id="current-level">1</span>
                </div>
                <div class="stat-row">
                    <span>XP Total</span>
                    <span class="stat-value" id="total-xp">0</span>
                </div>
                <div class="stat-row">
                    <span>Miss√µes Conclu√≠das</span>
                    <span class="stat-value" id="missions-completed">0</span>
                </div>
                <div class="stat-row">
                    <span>Progresso Global</span>
                    <span class="stat-value" id="global-progress">0%</span>
                </div>
                
                <div style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">Pr√≥ximo N√≠vel</div>
                <div class="xp-bar-container">
                    <div class="xp-bar-fill" id="xp-bar"></div>
                </div>
            </div>
        </aside>

        <!-- NAVEGA√á√ÉO DE CONTE√öDO -->
        <div style="grid-column: 2; width: 100%;">
            <nav class="main-nav">
                <button class="nav-item active" onclick="switchMainTab('timeline')">JORNADA</button>
                <button class="nav-item" onclick="switchMainTab('videos')">AULAS & DICAS</button>
            </nav>

            <!-- TIMELINE -->
            <section id="timeline-container" class="content-section active timeline">
                <!-- Levels will be injected here by JS -->
            </section>

            <!-- V√çDEOS -->
            <section id="videos-section" class="content-section">
                <div style="margin-bottom: 1.5rem;">
                    <input type="text" id="video-search" class="form-input" placeholder="üîç Pesquisar por t√≠tulo ou canal..." oninput="renderVideos()">
                </div>
                <div id="videos-container" class="video-grid">
                    <!-- Videos injected via JS -->
                </div>
            </section>
        </div>
    </main>

    <!-- MODAL DE MISS√ÉO -->
    <div class="modal-overlay" id="mission-modal">
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeModal()">√ó</button>
            <img id="modal-img" src="" class="mission-modal-banner" alt="Mission Banner" style="display:none;">
            
            <h2 id="modal-title" style="color: var(--primary); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px; font-size: 1.4rem;">T√≠tulo da Miss√£o</h2>
            
            <div id="modal-desc" class="mission-desc-box">Descri√ß√£o detalhada...</div>
            
            <div class="mission-reward-box">
                <div style="display: flex; align-items: center; gap: 10px; color: var(--text-muted); text-transform: uppercase; font-size: 0.85rem;">
                    <span style="font-size: 1.5rem;">üèÜ</span> RECOMPENSA
                </div>
                <div class="mission-reward-value">
                    +<span id="modal-xp">100</span> XP
                </div>
            </div>
            
            <button class="btn" id="complete-btn" style="width: 100%; margin-top: 0;">CONCLUIR MISS√ÉO</button>
        </div>
    </div>

    <!-- MODAL DE V√çDEO (PLAYER) -->
    <div class="modal-overlay" id="video-player-modal">
        <div class="modal-content">
            <button class="close-video-btn" onclick="closeVideoPlayer()">√ó</button>
            <div class="video-iframe-container">
                <iframe id="video-iframe" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="video-player-info">
                <h2 id="video-player-title">T√≠tulo do V√≠deo</h2>
                <p id="video-player-channel"></p>
                <p id="video-player-desc">Descri√ß√£o do v√≠deo...</p>
            </div>
        </div>
    </div>

    <!-- MODAL DE LEVEL UP -->
    <div class="modal-overlay" id="levelup-modal">
        <div class="modal-content" style="border-color: var(--success); box-shadow: 0 0 20px rgba(0,255,157,0.3);">
            <h1 style="font-size: 3rem; margin-bottom: 0.5rem;">LEVEL UP!</h1>
            <h2 id="new-level-title" style="color: var(--success);">N√≠vel 2 Desbloqueado</h2>
            <p style="margin: 1rem 0;">Voc√™ est√° mais perto dos 800+!</p>
            <button class="btn" onclick="closeLevelUp()">CONTINUAR</button>
        </div>
    </div>

    <!-- MODAL DE PERFIL (PROFESSIONAL SETTINGS) -->
    <div class="modal-overlay" id="profile-modal" style="display: flex;"> <!-- Come√ßa aberto se n√£o tiver save -->
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeProfileModal()">√ó</button>
            <h2 style="color: var(--primary); margin-bottom: 0.5rem;">CONFIGURA√á√ÉO DO CANDIDATO</h2>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Defina seu perfil para calibrar a dificuldade.</p>
            
            <!-- ABAS -->
            <div class="modal-tabs">
                <button class="tab-btn active" onclick="switchTab('tab-visual')">APAR√äNCIA</button>
                <button class="tab-btn" onclick="switchTab('tab-data')">DADOS PESSOAIS</button>
            </div>

            <!-- ABA 1: VISUAL -->
            <div id="tab-visual" class="tab-content active">
                <div class="visual-tab-grid">
                    <!-- Preview Card (Esquerda) -->
                    <div class="profile-preview-card" id="preview-card" style="margin-bottom: 0; display: flex; flex-direction: column; justify-content: center; min-height: 220px;">
                        <div class="preview-bg-icon" id="preview-bg-icon">üë®‚Äçüéì</div>
                        <div class="preview-avatar" id="preview-avatar-el">üë®‚Äçüéì</div>
                        <h3 id="preview-name-display" style="position: relative; z-index: 2; margin: 0;">Nick</h3>
                    </div>

                    <!-- Controles (Direita) -->
                    <div>
                        <div class="form-group">
                            <label class="form-label">Escolha seu Avatar</label>
                            <div class="avatar-grid" id="avatar-selection"></div>
                            
                            <div style="text-align: center; margin-top: 0.5rem;">
                                <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem;">Ou envie sua pr√≥pria foto:</p>
                                <label for="input-avatar-file" class="btn" style="background: transparent; border: 1px solid var(--primary); display: inline-block; width: 100%; padding: 0.5rem;">üìÅ Carregar do Arquivo</label>
                                <input type="file" id="input-avatar-file" accept="image/*" style="display: none;" onchange="handleFileUpload(this)">
                                <p id="avatar-feedback" style="font-size: 0.8rem; margin-top: 0.5rem; min-height: 1.2em; transition: 0.3s;"></p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Cor do Tema</label>
                            <div class="color-grid" id="color-selection" style="justify-content: flex-start;">
                                <!-- Gerado via JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 2: DADOS -->
            <div id="tab-data" class="tab-content">
                <div class="data-grid">
                    <div class="form-group full-width">
                        <label class="form-label">Nick (m√°x. 8 caracteres)</label>
                        <input type="text" id="input-name" class="form-input" placeholder="Seu Nick" maxlength="8" oninput="updatePreviewText()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="number" id="input-age" class="form-input" placeholder="17">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select id="input-sex" class="form-select">
                            <option value="M">Masculino</option>
                            <option value="F">Feminino</option>
                            <option value="NB">N√£o-Bin√°rio</option>
                            <option value="O">Outro</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Curso Alvo (Meta)</label>
                        <select id="input-course" class="form-select">
                            <!-- Preenchido via JS -->
                        </select>
                    </div>
                </div>
            </div>

            <p id="save-feedback" style="font-size: 0.9rem; margin-bottom: 0.5rem; text-align: center; min-height: 1.2em;"></p>
            <button class="btn" onclick="saveProfileData()" style="width: 100%;">SALVAR PERFIL</button>
        </div>
    </div>

    <!-- MODAL DE QUIZ (BOSS BATTLE) -->
    <div class="modal-overlay" id="quiz-modal">
        <div class="modal-content" style="max-width: 800px; width: 95%;">
            <h2 style="color: #ff4d4d; margin-bottom: 1rem;">DESAFIO FINAL: 30 QUEST√ïES</h2>
            <div class="quiz-container" id="quiz-body">
                <!-- Quest√µes injetadas via JS -->
            </div>
            <div style="margin-top: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <span id="quiz-score" style="font-weight: bold; color: var(--success);"></span>
                <div>
                    <button class="btn" onclick="submitQuiz()">ENVIAR RESPOSTAS</button>
                    <button class="btn undo" onclick="closeQuiz()">CANCELAR</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* --- DADOS DO JOGO (GAME DATA) --- */
        // Data estimada do ENEM (1¬∫ Domingo de Novembro - Ajust√°vel)
        const ENEM_DATE = new Date('2026-11-01T13:00:00'); 

        // Lista de Cursos (Simplificada para Demo, mas expans√≠vel)
        const COURSES = [
            "Administra√ß√£o", "Agronomia", "Arquitetura e Urbanismo", "Artes Visuais", 
            "Biomedicina", "Ci√™ncia da Computa√ß√£o", "Ci√™ncias Biol√≥gicas", "Ci√™ncias Cont√°beis", 
            "Cinema e Audiovisual", "Design", "Direito", "Educa√ß√£o F√≠sica", "Enfermagem", 
            "Engenharia Civil", "Engenharia da Computa√ß√£o", "Engenharia de Produ√ß√£o", "Engenharia El√©trica", "Engenharia Mec√¢nica", 
            "Farm√°cia", "Filosofia", "F√≠sica", "Fisioterapia", "Gastronomia", "Geografia", 
            "Hist√≥ria", "Jornalismo", "Letras", "Marketing", "Matem√°tica", "Medicina", 
            "Medicina Veterin√°ria", "Nutri√ß√£o", "Odontologia", "Pedagogia", "Psicologia", 
            "Publicidade e Propaganda", "Qu√≠mica", "Rela√ß√µes Internacionais", "Sistemas de Informa√ß√£o", "Zootecnia"
        ];

        const AVATARS = ["üë®‚Äçüéì", "üë©‚Äçüéì", "üë®‚Äçüíª", "üë©‚Äçüíª", "üë®‚Äçüî¨", "üë©‚Äçüî¨", "üß†", "üöÄ"];

        const THEMES = [
            { id: 'cyan', bg: 'linear-gradient(45deg, #00f3ff, #bc13fe)' }, // Default
            { id: 'fire', bg: 'linear-gradient(45deg, #ff4d4d, #ffaa00)' },
            { id: 'nature', bg: 'linear-gradient(45deg, #00ff9d, #00cc44)' },
            { id: 'ocean', bg: 'linear-gradient(45deg, #0088ff, #0033cc)' },
            { id: 'gold', bg: 'linear-gradient(45deg, #ffd700, #ffaa00)' },
            { id: 'dark', bg: 'linear-gradient(45deg, #444, #000)' }
        ];
        
        /* --- DADOS DOS V√çDEOS (YOUTUBE STYLE) --- */
        const VIDEOS = [
            { title: "MEU MODELO de reda√ß√£o do ENEM ü§Ø funciona para QUALQUER TEMA (ATUALIZADO 2026)", channel: "Sarah", desc: "üìö Monte aqui seu cronograma GRATUITAMENTE: https://materiais.questiona.com.br/comunidade-questiona", url: "https://youtu.be/VRQtqA3Fbeo" },
            { title: "O QUE √â O ENEM? COMO S√ÉO AS PROVAS? O QUE ESTUDAR? | Explicando do Zero", channel: "Manie", desc: `üìë Tudo sobre o Enem: https://bit.ly/32m6Ciw Resolva nossos simulados: https://bit.ly/2XqzSCS`, url: "https://youtu.be/5jq_kcNYzUo" },
            { title: "DICAS pra voc√™ TIRAR NOTA 1000 na REDA√á√ÉO DO ENEM", channel: "Prof. Noslen", desc: "No v√≠deo de hoje eu conto para voc√™s 5 segredos que v√£o te poupar de perder pontos na reda√ß√£o do ENEM e te deixar ainda mais perto de alcan√ßar a t√£o sonhada nota 1000!", url: "https://youtu.be/TuBKsV3lSQc" },
            { title: "PASSAR NO ENEM √© bem f√°cil, na real", channel: "bem f√°cil, na real", desc: "Voc√™ provavelmente deveria estar estudando‚Ä¶ ent√£o vem comigo aprender a estudar do jeito certo. Sem f√≥rmula milagrosa: foco, esfor√ßo e sono ‚Äî na pr√°tica ‚Äî pra transformar procrastina√ß√£o em resultado real no ENEM ou qualquer prova. No final, voc√™ sai com um plano simples e direto. Bora?", url: "https://youtu.be/lwuFcjj-yg8" },
            { title: "O QUE √â SISU? Como entrar em uma universidade p√∫blica fazendo o Enem | Explicando do Zero", channel: "Manie", desc: "O SiSU √© o sistema no qual os candidatos usam a nota do Enem para disputar vagas de cursos de gradua√ß√£o das universidades p√∫blicas. Todo ano, o MEC coloca 300 mil vagas gratuitas nas universidades p√∫blicas com ingresso pela nota do Enem. O SiSU acontece duas vezes por ano e cada  per√≠odo de inscri√ß√µes geralmente dura quatro dias.", url: "https://youtu.be/qImFDtzNm2E" },
        ];
        const LEVELS = [
            {
                id: 1,
                title: "N√≠vel 1: Funda√ß√£o e Diagn√≥stico",
                desc: "Antes de construir o pr√©dio, sonde o terreno. Descubra onde voc√™ est√°.",
                baseScore: 500,
                missions: [
                    { id: 101, title: "Simulado Diagn√≥stico (Raio-X)", image: "./assets/img/tarefa1.png", desc: "<strong>Objetivo:</strong> Entender seu n√≠vel atual sem press√£o de tempo.<br><br>1. Imprima a prova do ENEM 2020 (Dia 1).<br>2. Fa√ßa em ambiente silencioso, mas <strong>sem cron√¥metro</strong>.<br>3. Seja honesto: n√£o chute. Se n√£o sabe, deixe em branco.<br>4. Este resultado ser√° seu 'Ponto Zero' para medir evolu√ß√£o.", type: "exam", xp: 500, duration: "4h 30min" },
                    { id: 102, title: "Mapeamento de Lacunas", image: "./assets/img/tarefa2.png", desc: "<strong>N√£o basta corrigir!</strong> Crie uma planilha com 3 colunas para cada erro:<br><br>1. <strong>Conte√∫do:</strong> Eu n√£o sabia a mat√©ria?<br>2. <strong>Interpreta√ß√£o:</strong> Eu sabia, mas n√£o entendi o texto?<br>3. <strong>Aten√ß√£o:</strong> Errei conta ou leitura r√°pida?<br><br><em>Dica: Ataque primeiro os erros de conte√∫do base.</em>", type: "strategy", xp: 200, duration: "1h" },
                    { id: 103, title: "O Cronograma Realista", image: "./assets/img/tarefa3.png", desc: "Esque√ßa cronogramas de 12h. Monte um sustent√°vel:<br><br>‚Ä¢ Defina <strong>Blocos de Estudo</strong> de 1h30min.<br>‚Ä¢ Intercale mat√©rias opostas (ex: Mat e Hist) para descansar o c√©rebro.<br>‚Ä¢ Deixe o domingo livre ou para simulados.<br>‚Ä¢ <strong>Meta:</strong> Cumprir 80% do planejado √© melhor que 0% do perfeito.", type: "strategy", xp: 150, duration: "45min" },
                    { id: 104, title: "Matem√°tica: O Alicerce", image: "./assets/img/tarefa4.png", desc: "O ENEM ama o b√°sico. Antes de Logaritmo, domine:<br><br>‚úÖ Regra de Tr√™s (Simples e Composta)<br>‚úÖ Porcentagem e Juros<br>‚úÖ Fra√ß√µes e Decimais<br>‚úÖ Convers√£o de Unidades (km para m, h para s)<br><br><strong>Miss√£o:</strong> Resolver 50 quest√µes apenas desses temas.", type: "review", xp: 300, duration: "2h" }
                ]
            },
            {
                id: 2,
                title: "N√≠vel 2: Imers√£o e Pr√°tica",
                desc: "Aprofunde a teoria e comece a entender a linguagem da prova.",
                baseScore: 620,
                missions: [
                    { id: 201, title: "Laborat√≥rio de Humanas", image: "./assets/img/lvl2-1.png", desc: "Resolver prova de Humanas 2018.<br><br><strong>Foco:</strong> Interpreta√ß√£o de Texto e G√™neros Textuais.<br>Ao corrigir, leia a resolu√ß√£o comentada de TODAS as quest√µes, inclusive as que acertou. Entenda por que a alternativa B est√° errada, n√£o s√≥ por que a A est√° certa.", type: "exam", xp: 400, duration: "3h" },
                    { id: 202, title: "A F√≥rmula da Reda√ß√£o", image: "./assets/img/lvl2-2.png", desc: "N√£o reinvente a roda. Estruture seu esqueleto:<br><br>‚Ä¢ <strong>Intro:</strong> Contexto + Tese + 2 Argumentos.<br>‚Ä¢ <strong>D1 e D2:</strong> T√≥pico Frasal + Repert√≥rio + An√°lise Cr√≠tica.<br>‚Ä¢ <strong>Conclus√£o:</strong> Agente + A√ß√£o + Meio + Efeito + Detalhamento.<br><br><strong>Miss√£o:</strong> Escreva 2 reda√ß√µes focando apenas nessa estrutura.", type: "review", xp: 300, duration: "2h" },
                    { id: 203, title: "Natureza: O Que Sempre Cai", image: "./assets/img/lvl2-3.png", desc: "Ecologia representa ~30% da prova de Biologia.<br><br><strong>Domine:</strong><br>1. Ciclos Biogeoqu√≠micos (Nitrog√™nio e Carbono)<br>2. Rela√ß√µes Ecol√≥gicas (quem ganha/perde?)<br>3. Impactos Ambientais (Lixo, Eutrofiza√ß√£o).<br><br>Resolva 20 quest√µes espec√≠ficas disso.", type: "review", xp: 250, duration: "1h 30min" },
                    { id: 204, title: "Flashcards & Active Recall", image: "./assets/img/lvl2-4.png", desc: "Pare de apenas ler resumos. Force seu c√©rebro a lembrar.<br><br>Crie 50 flashcards (Anki ou papel) para:<br>‚Ä¢ F√≥rmulas de F√≠sica (Cinem√°tica/El√©trica)<br>‚Ä¢ Fun√ß√µes Org√¢nicas (Qu√≠mica)<br>‚Ä¢ Datas/Eventos chave de Hist√≥ria.<br>Revise diariamente por 15 min.", type: "strategy", xp: 200, duration: "1h" }
                ]
            },
            {
                id: 3,
                title: "N√≠vel 3: Estrat√©gia de Guerra",
                desc: "N√£o vence quem sabe mais, vence quem faz a melhor prova.",
                baseScore: 700,
                missions: [
                    { id: 301, title: "Simulado Cronometrado (TRI)", image: "./assets/img/lvl3-1.png", desc: "Prova 2021 completa. <strong>Tempo r√≠gido: 5h30min.</strong><br><br>‚Ä¢ Use m√°scara (se quiser simular o pior cen√°rio).<br>‚Ä¢ Sem pausas para celular.<br>‚Ä¢ √Ågua e lanche na mesa.<br>‚Ä¢ Sinta o cansa√ßo e aprenda a lidar com ele.", type: "exam", xp: 600, duration: "5h 30min" },
                    { id: 302, title: "A Arte de Pular (TRI)", image: "./assets/img/lvl3-2.png", desc: "O ENEM usa a Teoria de Resposta ao Item. Acertar dif√≠cil e errar f√°cil abaixa sua nota.<br><br><strong>T√©cnica das 3 Passadas:</strong><br>1. Leia e fa√ßa as f√°ceis imediatamente.<br>2. Marque as m√©dias para fazer depois.<br>3. As dif√≠ceis/trabalhosas ficam pro final (ou chute consciente).<br><strong>Nunca trave mais de 3 min numa quest√£o.</strong>", type: "strategy", xp: 300, duration: "40min" },
                    { id: 303, title: "Reda√ß√£o: O Pulo pro 900+", image: "./assets/img/lvl3-3.png", desc: "Refine suas compet√™ncias:<br><br>‚Ä¢ <strong>C1:</strong> Crase, v√≠rgula e concord√¢ncia.<br>‚Ä¢ <strong>C2:</strong> N√£o tangencie o tema.<br>‚Ä¢ <strong>C3:</strong> Projeto de texto (seus argumentos conversam?).<br>‚Ä¢ <strong>C4:</strong> Use conectivos (Nesse vi√©s, Ademais, Portanto) em todo in√≠cio de par√°grafo.", type: "review", xp: 400, duration: "1h 30min" }
                ]
            },
            {
                id: 4,
                title: "N√≠vel 4: Alta Performance",
                desc: "Refinamento final. Transforme fraquezas em pontos.",
                baseScore: 760,
                missions: [
                    { id: 401, title: "Maratona de Resist√™ncia", image: "./assets/img/lvl4-1.png", desc: "Simule um final de semana real (S√°bado e Domingo seguidos).<br><br>O objetivo aqui √© f√≠sico e mental. Teste qual lanche te d√° energia sem dar sono. Teste sua postura na cadeira. A dor nas costas tira mais pontos que a falta de estudo.", type: "exam", xp: 1000, duration: "2 Dias" },
                    { id: 402, title: "Revis√£o Espa√ßada Total", image: "./assets/img/lvl4-2.png", desc: "Pegue todos os seus flashcards e resumos.<br><br>A Curva do Esquecimento √© cruel. O que voc√™ estudou no N√≠vel 1 j√° est√° sumindo. Traga tudo de volta √† mem√≥ria de curto prazo agora.", type: "review", xp: 500, duration: "3h" },
                    { id: 403, title: "O Caderno de Erros", image: "./assets/img/lvl4-3.png", desc: "Pegue suas planilhas de erros dos N√≠veis 1, 2 e 3.<br><br><strong>Refa√ßa APENAS as quest√µes que voc√™ errou.</strong><br>Entender um erro antigo vale por 10 acertos novos. Transforme sua maior fraqueza em for√ßa.", type: "strategy", xp: 600, duration: "2h" }
                ]
            },
            {
                id: 5,
                title: "N√≠vel 5: A Chegada",
                desc: "O trabalho duro j√° foi feito. Agora √© controle emocional.",
                baseScore: 800,
                missions: [
                    { id: 501, title: "Polimento Final", image: "./assets/img/lvl5-1.png", desc: "<strong>Proibido aprender mat√©ria nova.</strong> Isso s√≥ gera ansiedade.<br><br>Apenas releia f√≥rmulas, conceitos chave e repert√≥rios de reda√ß√£o. Confie no que voc√™ j√° construiu.", type: "review", xp: 200, duration: "1h" },
                    { id: 502, title: "Kit de Sobreviv√™ncia", image: "./assets/img/lvl5-2.png", desc: "‚Ä¢ Caneta preta tubo transparente (leve 3).<br>‚Ä¢ Documento original com foto.<br>‚Ä¢ Cart√£o de confirma√ß√£o impresso.<br>‚Ä¢ √Ågua sem r√≥tulo.<br>‚Ä¢ Lanche pr√°tico (chocolate amargo, castanhas).<br>‚Ä¢ Verifique o trajeto no Google Maps.", type: "strategy", xp: 100, duration: "30min" },
                    { id: 503, title: "O Dia Zero", image: "./assets/img/lvl5-3.png", desc: "S√°bado pr√©-prova.<br><br><strong>ZERO ESTUDO.</strong><br>Seu c√©rebro precisa consolidar as sinapses. Veja um filme leve, coma algo saud√°vel, durma cedo. A prova √© amanh√£ e voc√™ est√° pronto.", type: "strategy", xp: 500, duration: "1 Dia" }
                ]
            },
            {
                id: 6,
                title: "N√≠vel 6: O Desafio Final",
                desc: "Prove que voc√™ est√° pronto. Simulado compacto e Reda√ß√£o.",
                baseScore: 999, // C√≥digo para Aprovado
                missions: [
                    { id: 601, title: "Simulado Compacto (30 Quest√µes)", image: "./assets/img/lvl6-1.png", desc: "Um teste r√°pido cobrindo as 4 √°reas do conhecimento. Clique para iniciar o quiz interativo.", type: "boss", xp: 2000, duration: "1h" },
                    { id: 602, title: "Reda√ß√£o Final: IA e Sociedade", image: "./assets/img/lvl6-2.png", desc: "<strong>Tema:</strong> 'Os desafios √©ticos e sociais da Intelig√™ncia Artificial no mercado de trabalho brasileiro.'<br><br>Escreva sua reda√ß√£o final cronometrando 1 hora. Use repert√≥rios como 'Revolu√ß√£o Industrial', 'Black Mirror' ou 'Zygmunt Bauman'.", type: "boss", xp: 1000, duration: "1h" }
                ]
            }
        ];

        /* --- DADOS DO QUIZ (30 QUEST√ïES RESUMIDAS) --- */
        const QUIZ_DATA = [
            { q: "Mat: Se um produto custa R$100 e tem aumento de 20% seguido de desconto de 20%, o pre√ßo final √©:", opts: ["R$ 100", "R$ 96", "R$ 99", "R$ 104"], a: 1 },
            { q: "Hum: A democracia ateniense na antiguidade era caracterizada por ser:", opts: ["Direta e excludente", "Representativa e universal", "Direta e universal", "Indireta e censit√°ria"], a: 0 },
            { q: "Nat: Qual organela √© respons√°vel pela respira√ß√£o celular?", opts: ["Ribossomo", "Lisossomo", "Mitoc√¥ndria", "Complexo de Golgi"], a: 2 },
            { q: "Ling: A fun√ß√£o da linguagem focada no canal de comunica√ß√£o √© a:", opts: ["Emotiva", "F√°tica", "Metalingu√≠stica", "Referencial"], a: 1 },
            { q: "Mat: A soma dos √¢ngulos internos de um tri√¢ngulo √© sempre:", opts: ["360¬∞", "180¬∞", "90¬∞", "270¬∞"], a: 1 },
            { q: "Hum: O processo de urbaniza√ß√£o brasileiro intensificou-se com:", opts: ["A minera√ß√£o no s√©c XVIII", "A industrializa√ß√£o no s√©c XX", "A cultura do caf√©", "A coloniza√ß√£o"], a: 1 },
            { q: "Nat: Na estequiometria, 1 mol de qualquer g√°s na CNTP ocupa:", opts: ["22,4 L", "10 L", "100 L", "1 L"], a: 0 },
            { q: "Ling: 'Vidas Secas' √© uma obra pertencente ao:", opts: ["Romantismo", "Modernismo (2¬™ fase)", "Parnasianismo", "Barroco"], a: 1 },
            { q: "Mat: A probabilidade de tirar 'Cara' em uma moeda honesta √©:", opts: ["25%", "50%", "75%", "100%"], a: 1 },
            { q: "Hum: A Guerra Fria foi um conflito ideol√≥gico entre:", opts: ["EUA e Alemanha", "EUA e URSS", "URSS e China", "Alemanha e Inglaterra"], a: 1 },
            { q: "Nat: A Lei de Ohm √© expressa pela f√≥rmula:", opts: ["V = R/i", "V = R.i", "P = i.U", "E = m.c¬≤"], a: 1 },
            { q: "Ling: O uso de 'pra' em vez de 'para' √© exemplo de:", opts: ["Erro crasso", "Varia√ß√£o lingu√≠stica", "Neologismo", "Estrangeirismo"], a: 1 },
            { q: "Mat: O volume de um cubo de aresta 3cm √©:", opts: ["9 cm¬≥", "18 cm¬≥", "27 cm¬≥", "81 cm¬≥"], a: 2 },
            { q: "Hum: O Plano Real (1994) teve como principal objetivo:", opts: ["Acabar com a Ditadura", "Controlar a hiperinfla√ß√£o", "Criar a Petrobras", "Iniciar a industrializa√ß√£o"], a: 1 },
            { q: "Nat: Is√≥topos s√£o √°tomos com mesmo n√∫mero de:", opts: ["Massa", "N√™utrons", "Pr√≥tons", "El√©trons"], a: 2 },
            { q: "Ling: A figura de linguagem que suaviza uma ideia √©:", opts: ["Hip√©rbole", "Eufemismo", "Met√°fora", "Ant√≠tese"], a: 1 },
            { q: "Mat: Em um tri√¢ngulo ret√¢ngulo, a¬≤ = b¬≤ + c¬≤ √© o teorema de:", opts: ["Thales", "Pit√°goras", "Bhaskara", "Arquimedes"], a: 1 },
            { q: "Hum: O IDH mede o desenvolvimento considerando:", opts: ["Apenas PIB", "Sa√∫de, Educa√ß√£o e Renda", "Seguran√ßa e Lazer", "Infla√ß√£o e Desemprego"], a: 1 },
            { q: "Nat: O pH 2 indica uma subst√¢ncia:", opts: ["Neutra", "B√°sica", "√Åcida", "Salina"], a: 2 },
            { q: "Ling: O Trovadorismo foi o primeiro movimento liter√°rio:", opts: ["Brasileiro", "Portugu√™s", "Franc√™s", "Ingl√™s"], a: 1 },
            { q: "Mat: 2 elevado a 3 √© igual a:", opts: ["6", "8", "9", "5"], a: 1 },
            { q: "Hum: A globaliza√ß√£o √© caracterizada por:", opts: ["Isolamento cultural", "Fluxos de capital e informa√ß√£o", "Fim do capitalismo", "Barreiras comerciais r√≠gidas"], a: 1 },
            { q: "Nat: A 1¬™ Lei de Newton √© a lei da:", opts: ["A√ß√£o e Rea√ß√£o", "In√©rcia", "Gravita√ß√£o", "Termodin√¢mica"], a: 1 },
            { q: "Ling: 'Machado de Assis' fundou a:", opts: ["Academia Brasileira de Letras", "Semana de Arte Moderna", "Tropic√°lia", "Escola de Belas Artes"], a: 0 },
            { q: "Mat: A raiz quadrada de 144 √©:", opts: ["10", "11", "12", "14"], a: 2 },
            { q: "Hum: O clima predominante no sert√£o nordestino √©:", opts: ["Equatorial", "Tropical", "Semi√°rido", "Subtropical"], a: 2 },
            { q: "Nat: A fotoss√≠ntese converte energia luminosa em:", opts: ["Energia T√©rmica", "Energia Qu√≠mica", "Energia Cin√©tica", "Energia Nuclear"], a: 1 },
            { q: "Ling: O g√™nero 'Editorial' expressa:", opts: ["A opini√£o do jornal", "Uma not√≠cia imparcial", "Uma narrativa ficcional", "Um poema l√≠rico"], a: 0 },
            { q: "Mat: Se x + 5 = 12, ent√£o x √©:", opts: ["5", "6", "7", "8"], a: 2 },
            { q: "Hum: A Revolu√ß√£o Francesa (1789) lutava por:", opts: ["Liberdade, Igualdade, Fraternidade", "Deus, P√°tria, Fam√≠lia", "Ordem e Progresso", "Paz e Amor"], a: 0 }
        ];

        /* --- ESTADO DO USU√ÅRIO (STATE MANAGEMENT) --- */
        let gameState = {
            user: { 
                name: "", 
                age: "", 
                sex: "", 
                course: "", 
                avatar: "üë®‚Äçüéì",
                themeColor: "linear-gradient(45deg, #00f3ff, #bc13fe)",
                level: 1, 
                xp: 0 
            },
            completedMissions: [], // Array de IDs
            startDate: new Date().toISOString()
        };

        // Carregar do LocalStorage
        function loadGame() {
            initProfileModal(); // Prepara o modal
            const saved = localStorage.getItem('enemGameSave');
            if (saved) {
                gameState = JSON.parse(saved);
                document.getElementById('profile-modal').style.display = 'none';
                if(!gameState.user.name) {
                    document.getElementById('profile-modal').style.display = 'flex';
                    document.body.classList.add('no-scroll');
                }
            } else {
                // Primeiro acesso
                document.body.classList.add('no-scroll');
            }
            updateUI();
        }

        function saveGame() {
            localStorage.setItem('enemGameSave', JSON.stringify(gameState));
            updateUI();
        }

        /* --- L√ìGICA DO JOGO --- */
        
        // Contador Regressivo
        function updateCountdown() {
            const now = new Date();
            const diff = ENEM_DATE - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            document.getElementById('days-left').innerText = days > 0 ? days : 0;
            
            if (days < 0) {
                document.getElementById('countdown').innerHTML = "üö® DIA DA PROVA!";
                document.getElementById('countdown').style.borderColor = "red";
            }
        }

        // C√°lculo de XP e N√≠vel
        function calculateProgress() {
            // L√≥gica simples: N√≠vel sobe a cada 1000 XP (exemplo)
            const xpPerLevel = 1000;
            const currentLevel = Math.floor(gameState.user.xp / xpPerLevel) + 1;
            
            // Checar Level Up
            if (currentLevel > gameState.user.level) {
                gameState.user.level = currentLevel;
                showLevelUpModal(currentLevel);
            }

            // XP da barra
            const xpInCurrentLevel = gameState.user.xp % xpPerLevel;
            const percentage = (xpInCurrentLevel / xpPerLevel) * 100;
            
            document.getElementById('xp-bar').style.width = `${percentage}%`;
            document.getElementById('current-level').innerText = gameState.user.level;
            document.getElementById('total-xp').innerText = gameState.user.xp;
            document.getElementById('missions-completed').innerText = gameState.completedMissions.length;

            // Progresso Global
            const totalMissions = LEVELS.reduce((acc, lvl) => acc + lvl.missions.length, 0);
            const globalPercent = Math.round((gameState.completedMissions.length / totalMissions) * 100);
            document.getElementById('global-progress').innerText = `${globalPercent}%`;
        }

        /* --- PERFIL E CONFIGURA√á√ïES --- */
        function initProfileModal() {
            // Preencher Cursos
            const courseSelect = document.getElementById('input-course');
            courseSelect.innerHTML = '<option value="" disabled selected>Selecione seu curso...</option>';
            COURSES.sort().forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                courseSelect.appendChild(opt);
            });

            // Preencher Avatares
            const avatarContainer = document.getElementById('avatar-selection');
            avatarContainer.innerHTML = '';
            AVATARS.forEach(av => {
                const div = document.createElement('div');
                div.className = 'avatar-option';
                div.innerText = av;
                div.style.fontSize = '30px';
                div.style.display = 'flex';
                div.style.justifyContent = 'center';
                div.style.alignItems = 'center';
                div.onclick = () => selectAvatar(av, div);
                avatarContainer.appendChild(div);
            });

            // Preencher Cores
            const colorContainer = document.getElementById('color-selection');
            colorContainer.innerHTML = '';
            THEMES.forEach(t => {
                const div = document.createElement('div');
                div.className = 'color-option';
                div.style.background = t.bg;
                div.onclick = () => selectColor(t.bg, div);
                colorContainer.appendChild(div);
            });
        }
    
    function handleFileUpload(input) {
        const feedback = document.getElementById('avatar-feedback');
        feedback.innerText = ""; // Limpar anterior

        if (input.files && input.files[0]) {
            const file = input.files[0];
            if (file.size > 1024 * 1024) { // Limite de 1MB para n√£o travar o navegador
                feedback.innerText = "A imagem √© muito grande! Escolha uma menor que 1MB.";
                feedback.style.color = "#ff4d4d";
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                selectedAvatarTemp = e.target.result;
                document.querySelectorAll('.avatar-option').forEach(d => d.classList.remove('selected'));
                feedback.innerText = "Foto carregada com sucesso! Clique em SALVAR PERFIL.";
                feedback.style.color = "var(--success)";
                updatePreview();
            }
            reader.readAsDataURL(file);
        }
    }

        let selectedAvatarTemp = "üë®‚Äçüéì";
        let selectedColorTemp = "linear-gradient(45deg, #00f3ff, #bc13fe)";

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            // Encontrar o bot√£o correspondente (simplificado)
            const btnIndex = tabId === 'tab-visual' ? 0 : 1;
            document.querySelectorAll('.tab-btn')[btnIndex].classList.add('active');
        }

        function selectAvatar(av, el) {
            selectedAvatarTemp = av;
            document.querySelectorAll('.avatar-option').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            updatePreview();
        }

        function selectColor(bg, el) {
            selectedColorTemp = bg;
            document.querySelectorAll('.color-option').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            updatePreview();
        }

        function updatePreview() {
            const avEl = document.getElementById('preview-avatar-el');
            const bgIcon = document.getElementById('preview-bg-icon');
            
            avEl.style.background = selectedColorTemp;
            
            if (selectedAvatarTemp.startsWith('data:image')) {
                avEl.innerHTML = `<img src="${selectedAvatarTemp}" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
                bgIcon.innerText = ""; // Limpar √≠cone de fundo se for imagem
            } else {
                avEl.innerHTML = selectedAvatarTemp;
                bgIcon.innerText = selectedAvatarTemp;
            }
        }

        function updatePreviewText() {
            const name = document.getElementById('input-name').value;
            document.getElementById('preview-name-display').innerText = name || "Nick";
            
        }

        function openProfileSettings() {
            document.getElementById('input-name').value = gameState.user.name;
            document.getElementById('input-age').value = gameState.user.age;
            document.getElementById('input-sex').value = gameState.user.sex || "M";
            document.getElementById('input-course').value = gameState.user.course;
        
        selectedAvatarTemp = gameState.user.avatar || "üë®‚Äçüéì";
        selectedColorTemp = gameState.user.themeColor || THEMES[0].bg;
        
        // Visual feedback for emoji selection
        document.querySelectorAll('.avatar-option').forEach(d => {
            d.classList.remove('selected');
            if (d.innerText === selectedAvatarTemp) d.classList.add('selected');
        });

        // Visual feedback for color selection
        document.querySelectorAll('.color-option').forEach(d => {
            d.classList.remove('selected');
            if (d.style.background === selectedColorTemp) d.classList.add('selected');
        });
        
        // Limpar mensagens de feedback antigas
        document.getElementById('avatar-feedback').innerText = "";
        document.getElementById('save-feedback').innerText = "";

        updatePreview();
        updatePreviewText();
        switchTab('tab-visual'); // Abrir na aba visual

            document.getElementById('profile-modal').style.display = 'flex';
            document.body.classList.add('no-scroll');
        }

        function saveProfileData() {
            const name = document.getElementById('input-name').value;
            const course = document.getElementById('input-course').value;
            const feedback = document.getElementById('save-feedback');
            
            if(!name || !course) {
                feedback.innerText = "Por favor, preencha seu Nick e o Curso desejado!";
                feedback.style.color = "#ff4d4d";
                switchTab('tab-data'); // Mudar para aba de dados se faltar algo
                return;
            }

            gameState.user.name = name;
            gameState.user.age = document.getElementById('input-age').value;
            gameState.user.sex = document.getElementById('input-sex').value;
            gameState.user.course = course;
            gameState.user.avatar = selectedAvatarTemp;
            gameState.user.themeColor = selectedColorTemp;

            saveGame();
            closeProfileModal();
        }

        function closeProfileModal() {
            document.getElementById('profile-modal').style.display = 'none';
            document.body.classList.remove('no-scroll');
        }

        function logout() {
            if(confirm("Tem certeza que deseja sair? Isso apagar√° todo o seu progresso atual.")) {
                localStorage.removeItem('enemGameSave');
                location.reload();
            }
        }

        function getTargetScore(baseScore) {
            // L√≥gica de dificuldade baseada no curso
            if (!gameState.user.course) return baseScore;
            
            const highTier = ["Medicina", "Engenharia Aeron√°utica", "Direito", "Odontologia", "Engenharia da Computa√ß√£o"];
            const midTier = ["Engenharia Civil", "Psicologia", "Arquitetura e Urbanismo"];
            
            let multiplier = 1.0;
            if (highTier.includes(gameState.user.course)) multiplier = 1.1; // +10% dificuldade
            else if (midTier.includes(gameState.user.course)) multiplier = 1.05;

            let final = Math.round(baseScore * multiplier);
            if (baseScore === 999) return "APROVADO"; // Boss level
            return `~${final} pontos`;
        }

        // Helper para extrair ID do Youtube e gerar Thumbnail
        function getYoutubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function normalizeString(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().replace(/\s+/g, "");
        }

        function renderVideos() {
            const searchInput = document.getElementById('video-search')?.value || "";
            const searchTerm = normalizeString(searchInput);
            const container = document.getElementById('videos-container');
            container.innerHTML = '';

            const filteredVideos = VIDEOS.filter(video => 
                normalizeString(video.title).includes(searchTerm) || 
                normalizeString(video.channel).includes(searchTerm)
            );

            if (filteredVideos.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-muted);">Nenhum v√≠deo encontrado.</div>';
                return;
            }

            filteredVideos.forEach(video => {
                const ytId = getYoutubeId(video.url);
                // Se for link do youtube usa a thumb real, se n√£o usa placeholder
                const thumbSrc = ytId 
                    ? `https://img.youtube.com/vi/${ytId}/mqdefault.jpg` 
                    : `https://placehold.co/640x360/222/fff?text=VIDEO`;

                const card = document.createElement('div');
                card.className = 'video-card';
                card.onclick = () => playVideo(video);
                
                card.innerHTML = `
                    <div class="video-thumb-wrapper">
                        <img src="${thumbSrc}" class="video-thumb" alt="${video.title}">
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">${video.channel}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function playVideo(video) {
            const ytId = getYoutubeId(video.url);
            if (!ytId) return window.open(video.url, '_blank'); // Fallback se n√£o for YouTube

            document.getElementById('video-player-title').innerText = video.title;
            document.getElementById('video-player-channel').innerText = video.channel;
            document.getElementById('video-player-desc').innerText = video.desc || `Assista ao v√≠deo completo no YouTube.`;
            // Par√¢metros para um player mais limpo: sem v√≠deos relacionados de outros canais e sem a barra de informa√ß√µes superior
            document.getElementById('video-iframe').src = `https://www.youtube.com/embed/${ytId}?autoplay=1&rel=0&showinfo=0`;
            document.getElementById('video-player-modal').style.display = 'flex';
        }

        function closeVideoPlayer() {
            document.getElementById('video-player-modal').style.display = 'none';
            document.getElementById('video-iframe').src = ""; // Parar o v√≠deo
        }

        function switchMainTab(tabName) {
            // Atualizar bot√µes
            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            // O bot√£o clicado precisa ser identificado, mas aqui simplificamos pegando pelo texto ou ordem
            // Vamos usar event.target no onclick inline para facilitar, ou buscar pelo texto
            const buttons = document.querySelectorAll('.nav-item');
            if(tabName === 'timeline') buttons[0].classList.add('active');
            else buttons[1].classList.add('active');

            // Atualizar se√ß√µes
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
            if(tabName === 'timeline') document.getElementById('timeline-container').classList.add('active');
            else document.getElementById('videos-section').classList.add('active');
        }

        /* --- RENDERIZA√á√ÉO DA UI --- */

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';

            let previousMissionCompleted = true; // A primeira miss√£o come√ßa liberada

            LEVELS.forEach(level => {
                // Determinar estado do n√≠vel (bloqueado, ativo, completo)
                // Simplifica√ß√£o: N√≠vel do usu√°rio determina visibilidade
                let statusClass = '';
                const isLevelComplete = level.missions.every(m => gameState.completedMissions.includes(m.id));
                
                if (gameState.user.level >= level.id) statusClass = 'active';
                if (isLevelComplete) statusClass += ' completed';

                const targetScore = getTargetScore(level.baseScore);

                const scoreBadge = isLevelComplete 
                    ? `<span class="score-badge">Nota Estimada: ${targetScore}</span>` 
                    : '';
                
                const section = document.createElement('div');
                section.className = `level-section ${statusClass}`;
                
                let missionsHTML = '';
                level.missions.forEach(mission => {
                    const isDone = gameState.completedMissions.includes(mission.id);
                    const isLocked = !previousMissionCompleted;

                    // Atualiza o estado para a pr√≥xima itera√ß√£o
                    if (isDone) {
                        previousMissionCompleted = true;
                    } else {
                        previousMissionCompleted = false; // A pr√≥xima estar√° bloqueada
                    }

                    const doneClass = isDone ? 'done' : '';
                    const lockedClass = isLocked ? 'locked' : '';
                    const percentText = isDone ? '100%' : '0%';
                    const imgSrc = mission.image;
                    
                    missionsHTML += `
                        <div class="mission-card ${doneClass} ${lockedClass}" onclick="openMission(${mission.id})">
                            <img src="${imgSrc}" class="mission-img" alt="Mission Cover">
                            <div class="mission-content">
                                <div>
                                    <div class="mission-header">
                                        <span class="tag ${mission.type}">${mission.type}</span>
                                        <div class="mission-duration">‚è± <span>${mission.duration}</span></div>
                                    </div>
                                    <h4 style="color: #fff; margin-bottom: 0.3rem; font-size: 1rem; line-height: 1.4;">${mission.title}</h4>
                                </div>
                                <div class="mission-footer" style="display:flex; justify-content:space-between; align-items:center; margin-top:auto;">
                                    <span style="color: var(--success); font-size: 0.8rem;">+${mission.xp} XP</span>
                                    <span class="mission-percent">${percentText}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                section.innerHTML = `
                    <div class="level-header">
                        <div class="level-badge"></div>
                        <h3 class="level-title">${level.title}</h3>
                        ${scoreBadge}
                    </div>
                    <div class="missions-grid">
                        ${missionsHTML}
                    </div>
                `;
                container.appendChild(section);
            });
        }

        function updateUI() {
            calculateProgress();
            renderTimeline();
            renderVideos();
            
            // Helper to render avatar (Image or Emoji)
            const renderAv = (id, av, name) => {
                const el = document.getElementById(id);
                el.innerHTML = '';
                if (av && av.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = av;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    el.appendChild(img);
                    el.style.background = gameState.user.themeColor || THEMES[0].bg;
                } else {
                    el.innerText = av || (name ? name.charAt(0).toUpperCase() : "U");
                    el.style.background = gameState.user.themeColor || THEMES[0].bg;
                }
            };

            document.getElementById('user-name-display').innerText = gameState.user.name;
            renderAv('user-avatar', gameState.user.avatar, gameState.user.name);
            
            document.getElementById('sidebar-name').innerText = gameState.user.name || "Candidato";
            document.getElementById('sidebar-course').innerText = gameState.user.course || "Curso n√£o definido";
            renderAv('sidebar-avatar', gameState.user.avatar, gameState.user.name);
        }

        /* --- INTERA√á√ÉO COM MODAIS --- */
        
        let currentMissionId = null;

        function openMission(id) {
            // Encontrar miss√£o
            let mission = null;
            LEVELS.forEach(lvl => {
                const found = lvl.missions.find(m => m.id === id);
                if (found) mission = found;
            });

            if (!mission) return;

            currentMissionId = mission.id;
            const isDone = gameState.completedMissions.includes(id);

            document.getElementById('modal-title').innerText = mission.title;
            document.getElementById('modal-desc').innerHTML = mission.desc;
            document.getElementById('modal-xp').innerText = mission.xp;

            const imgEl = document.getElementById('modal-img');
            if(imgEl) {
                imgEl.src = mission.image;
                imgEl.style.display = 'block';
            }
            
            const btn = document.getElementById('complete-btn');
            
            // Configurar bot√£o baseado no estado
            if (isDone) {
                btn.innerText = "DESFAZER MISS√ÉO";
                btn.className = "btn undo";
                btn.onclick = () => toggleMission(mission);
            } else {
                if (mission.type === 'boss' && mission.id === 601) {
                    btn.innerText = "INICIAR QUIZ";
                    btn.className = "btn";
                    btn.onclick = () => startQuiz();
                } else {
                    btn.innerText = "CONCLUIR MISS√ÉO";
                    btn.className = "btn";
                    btn.onclick = () => toggleMission(mission);
                }
            }

            document.getElementById('mission-modal').style.display = 'flex';
        }

        function toggleMission(mission) {
            const index = gameState.completedMissions.indexOf(mission.id);
            
            if (index === -1) {
                // Marcar como feito
                gameState.completedMissions.push(mission.id);
                gameState.user.xp += mission.xp;
            } else {
                // Desmarcar
                gameState.completedMissions.splice(index, 1);
                gameState.user.xp -= mission.xp;
            }
            
            saveGame();
            closeModal();
        }

        /* --- L√ìGICA DO QUIZ --- */
        function startQuiz() {
            closeModal(); // Fecha o modal da miss√£o
            const quizBody = document.getElementById('quiz-body');
            quizBody.innerHTML = '';
            document.getElementById('quiz-score').innerText = '';

            QUIZ_DATA.forEach((item, index) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'quiz-question';
                
                let optsHTML = '';
                item.opts.forEach((opt, i) => {
                    optsHTML += `<span class="quiz-opt" onclick="selectOpt(${index}, ${i}, this)">${opt}</span>`;
                });

                qDiv.innerHTML = `
                    <p><strong>${index + 1}.</strong> ${item.q}</p>
                    <div id="q-opts-${index}">${optsHTML}</div>
                `;
                quizBody.appendChild(qDiv);
            });

            document.getElementById('quiz-modal').style.display = 'flex';
        }

        let userAnswers = {};

        function selectOpt(qIndex, optIndex, el) {
            userAnswers[qIndex] = optIndex;
            // Visual selection
            const parent = document.getElementById(`q-opts-${qIndex}`);
            Array.from(parent.children).forEach(child => child.classList.remove('selected'));
            el.classList.add('selected');
        }

        function submitQuiz() {
            let score = 0;
            QUIZ_DATA.forEach((item, index) => {
                if (userAnswers[index] === item.a) score++;
            });

            const finalScore = Math.round((score / QUIZ_DATA.length) * 1000); // Nota estilo ENEM
            document.getElementById('quiz-score').innerText = `Voc√™ acertou ${score}/${QUIZ_DATA.length} (Nota aprox: ${finalScore})`;
            
            if (score >= 15) { // Passou com 50%
                // Auto completar a miss√£o do quiz
                const mission = LEVELS[5].missions[0];
                if (!gameState.completedMissions.includes(mission.id)) {
                    gameState.completedMissions.push(mission.id);
                    gameState.user.xp += mission.xp;
                }
                saveGame();
                
                // Feedback visual no pr√≥prio modal em vez de alert
                const scoreEl = document.getElementById('quiz-score');
                scoreEl.innerHTML = `Voc√™ acertou ${score}/${QUIZ_DATA.length} (Nota aprox: ${finalScore})<br><span style="color: var(--primary); text-shadow: 0 0 10px var(--primary);">PARAB√âNS! VOC√ä FOI APROVADO!</span>`;
                
                setTimeout(() => {
                    closeQuiz();
                    updateUI();
                }, 3000);
            }
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').style.display = 'none';
        }

        function closeModal() {
            document.getElementById('mission-modal').style.display = 'none';
        }

        function showLevelUpModal(level) {
            document.getElementById('new-level-title').innerText = `N√≠vel ${level} Alcan√ßado`;
            document.getElementById('levelup-modal').style.display = 'flex';
        }

        function closeLevelUp() {
            document.getElementById('levelup-modal').style.display = 'none';
        }

        /* --- INICIALIZA√á√ÉO --- */
        window.onload = () => {
            loadGame();
            updateCountdown();
            setInterval(updateCountdown, 60000); // Atualiza timer a cada minuto
        };

    </script>
</body>
</html>
